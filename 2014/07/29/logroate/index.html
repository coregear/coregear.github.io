<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>OPS_BLOG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="使用logrotate处理应用日志
参考：http://huoding.com/2013/04/21/246
1234567891011vi /etc/logrotate.d/nginx/data/logs/nginx/*.log {    daily    dateext    compress    rotate 90    sharedscripts    postrotate">
<meta property="og:type" content="article">
<meta property="og:title" content="OPS_BLOG">
<meta property="og:url" content="http://coregear.github.io/2014/07/29/logroate/">
<meta property="og:site_name" content="OPS_BLOG">
<meta property="og:description" content="使用logrotate处理应用日志
参考：http://huoding.com/2013/04/21/246
1234567891011vi /etc/logrotate.d/nginx/data/logs/nginx/*.log {    daily    dateext    compress    rotate 90    sharedscripts    postrotate">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OPS_BLOG">
<meta name="twitter:description" content="使用logrotate处理应用日志
参考：http://huoding.com/2013/04/21/246
1234567891011vi /etc/logrotate.d/nginx/data/logs/nginx/*.log {    daily    dateext    compress    rotate 90    sharedscripts    postrotate">

  
    <link rel="alternative" href="/atom.xml" title="OPS_BLOG" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">OPS_BLOG</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">ops automation, testing, trouble shooting.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="coregear.github.io">
        </form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-logroate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/29/logroate/" class="article-date">
  <time datetime="2014-07-29T08:38:11.000Z" itemprop="datePublished">7月 29 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="使用logrotate处理应用日志">使用logrotate处理应用日志</h2>
<p>参考：<a href="http://huoding.com/2013/04/21/246" target="_blank" rel="external">http://huoding.com/2013/04/21/246</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vi /etc/logrotate.d/nginx</div><div class="line">/data/logs/nginx/*.log {</div><div class="line">    daily</div><div class="line">    dateext</div><div class="line">    compress</div><div class="line">    rotate <span class="number">90</span></div><div class="line">    sharedscripts</div><div class="line">    postrotate</div><div class="line">        kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`</div><div class="line">    endscript</div><div class="line">}</div></pre></td></tr></table></figure>

<ul>
<li><p><strong>dateext</strong>       Archive  old versions of log files adding a daily extension like YYYYMMDD instead of simply adding a number.</p>
</li>
<li><p><strong>sharedscripts</strong>     Normally, prescript and postscript scripts are run for each log which is rotated and the absolute path tothe log file is passed as first argument to the script. That means a single script may be run multiple times for log file entries which match multiple files (such as the /var/log/news/* example).  If  sharedscripts  is  specified,  the scripts are only run once, no matter how many logs match the wildcarded pattern, and whole pattern is passed to them.  However, if none of the logs in the pattern require rotating,the  scripts  will not be run at all. This option overrides the nosharedscripts option and implies create option.</p>
</li>
</ul>
<p>如果你等不及CRON，可以通过如下命令来手动执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">logrotate <span class="operator">-f</span> /etc/logrotate.d/nginx</div></pre></td></tr></table></figure>

<p>当然，正式执行前最好通过Debug选项来验证一下，这对调试也很重要：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">logrotate <span class="operator">-d</span> <span class="operator">-f</span> /etc/logrotate.d/nginx</div></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://coregear.github.io/2014/07/29/logroate/" data-id="lbo60x1q4uizxrnl" class="article-share-link">分享到</a>
      
        <a href="http://coregear.github.io/2014/07/29/logroate/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/07/29/nginx_lua_module/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07">七月 2014</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/07/29/testing/">testing</a>
          </li>
        
          <li>
            <a href="/2014/07/29/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2014/07/29/nginx_lua_module/">(no title)</a>
          </li>
        
          <li>
            <a href="/2014/07/29/logroate/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://reqianduan.com" target="_blank">热前端</a>
          </li>
        
          <li>
            <a href="http://themes.xiguabaobao.com" target="_blank">西瓜宝宝主题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 coregear<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape+</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'coregeargithubio';
  
  var disqus_url = 'http://coregear.github.io/2014/07/29/logroate/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>



<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>