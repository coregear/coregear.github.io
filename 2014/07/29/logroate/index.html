<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>OPS_BLOG</title>
  <meta name="author" content="coregear">

  
  <meta name="description" content="使用logrotate处理应用日志
参考：http://huoding.com/2013/04/21/246
1234567891011vi /etc/logrotate.d/nginx/data/logs/nginx/*.log {    daily    dateext    compress ">
  
  

  <link rel="alternate" href="/atom.xml" title="OPS_BLOG" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><nav>
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
</nav></header>
  <div id="content" class="inner"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title"></h1>
  

    <time datetime="2014-07-29T08:38:11.000Z">
  <span class="day">29</span><span class="month">Jul</span>
</time>
  </header>
  <div class="entry-content">
    
      <h2 id="使用logrotate处理应用日志">使用logrotate处理应用日志</h2>
<p>参考：<a href="http://huoding.com/2013/04/21/246" target="_blank" rel="external">http://huoding.com/2013/04/21/246</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vi /etc/logrotate.d/nginx</div><div class="line">/data/logs/nginx/*.log {</div><div class="line">    daily</div><div class="line">    dateext</div><div class="line">    compress</div><div class="line">    rotate <span class="number">90</span></div><div class="line">    sharedscripts</div><div class="line">    postrotate</div><div class="line">        kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`</div><div class="line">    endscript</div><div class="line">}</div></pre></td></tr></table></figure>

<ul>
<li><p><strong>dateext</strong>       Archive  old versions of log files adding a daily extension like YYYYMMDD instead of simply adding a number.</p>
</li>
<li><p><strong>sharedscripts</strong>     Normally, prescript and postscript scripts are run for each log which is rotated and the absolute path tothe log file is passed as first argument to the script. That means a single script may be run multiple times for log file entries which match multiple files (such as the /var/log/news/* example).  If  sharedscripts  is  specified,  the scripts are only run once, no matter how many logs match the wildcarded pattern, and whole pattern is passed to them.  However, if none of the logs in the pattern require rotating,the  scripts  will not be run at all. This option overrides the nosharedscripts option and implies create option.</p>
</li>
</ul>
<p>如果你等不及CRON，可以通过如下命令来手动执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">logrotate <span class="operator">-f</span> /etc/logrotate.d/nginx</div></pre></td></tr></table></figure>

<p>当然，正式执行前最好通过Debug选项来验证一下，这对调试也很重要：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">logrotate <span class="operator">-d</span> <span class="operator">-f</span> /etc/logrotate.d/nginx</div></pre></td></tr></table></figure>


    
    
    <footer class="meta">
      
      
      
    </footer>
    
  </div>
  
<section id="comment">
  <div id="disqus_thread" aria-live="polite">
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</article></div>
  <footer id="footer" class="inner"><div class="social alignright">
  
  
  
  
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>
<p>
  
  &copy; 2014 coregear
  
</p>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'coregeargithubio';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="phasebeam">
  <canvas></canvas>
  <canvas></canvas>
  <canvas></canvas>
</div>
<script src="/js/phasebeam.js"></script>
</body>
</html>